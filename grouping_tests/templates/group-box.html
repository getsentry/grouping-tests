<div class="card mb-1">
    <div class="card-header">
        <div class="float-start">
            <a href="{{ url }}">{{ node.exemplar.title }}</a>
            <small class="text-muted"
                data-bs-toggle="collapse"
                data-bs-target="#children-of-{{ node.name }}"
                aria-expanded="true"
                aria-controls="children-of-{{ node.name }}"
            >
                {{ node.exemplar.culprit|default_if_none:"" }}
            </small>
        </div>
        <div class="float-end text-muted">
            <span title="events in this node">
                üìé {{ node.item_count }}
            </span>
            /
            <span title="events in subtree">
                üìÅ {{ node.total_item_count }}
            </span>
        </div>
    </div>
    {% if node.exemplar.subtitle or node_diff %}
        <div class="card-body">
            <p>{{ node.exemplar.subtitle }}</p>
            <button
                class="show-diff btn btn-outline-primary"
                data-source="node-diff-{{ node.name }}"
                data-target="diff-viewer-{{ node.name }}"
            >Show grouping diff</button>
            <pre id="node-diff-{{ node.name }}" class="visually-hidden">{{ node_diff }}</pre>
            <div id="diff-viewer-{{ node.name }}"></div>
        </div>
    {% endif %}
</div>

{% if node.children %}
    <div id="children-of-{{ node.name }}" class="collapse show ms-5 mb-3">
        {% for node, url, node_diff, children in children %}
            {% include 'group-box.html' %}
        {% endfor %}
    </div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.show-diff').forEach(button => {
            button.addEventListener('click', (event) => {
                const button = event.target;

                const source = document.getElementById(button.dataset['source']);
                const target = document.getElementById(button.dataset['target']);

                var diffHtml = Diff2Html.html(source.innerHTML, {
                    drawFileList: false,
                    matching: 'lines',
                    outputFormat: 'side-by-side',
                });
                target.innerHTML = diffHtml;
            });
        });

    });
</script>